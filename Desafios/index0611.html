<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./style.css" />
    <style>
        /* Estilo para destacar células */
        .highlight {
            background-color: yellow;
        }
    </style>
</head>
<body>
    <div>
        <label for="quantidade">Quantidade de pessoas:</label>
        <input type="number" id="quantidade" min="1" value="5">
        <button id="botaoTabela">Carregar Tabela</button>
    </div>
    <div>
        <label for="destaqueFiltro">Destacar Dado:</label>
        <input type="search" id="destaqueFiltro" placeholder="Digite para destacar">
    </div>
    <div>
        <label for="nomeFiltro">Pesquisar Nome:</label>
        <input type="search" id="nomeFiltro" placeholder="Digite um nome">
    </div>
    <div id="tabela"></div>
</body>
<script>
    const colPessoas = ["Nome", "Telefone", "Aniversário", "Email"];
    const propPessoas = ["firstname", "phone", "birthday", "email"];

    const carregarDiv = (dados, divId, propriedades, colunas) => {
        const div = document.getElementById(divId);

        const linhas = dados.map(
            (item) =>
                `<tr>
                    ${propriedades.map((prop) => `<td>${item[prop]}</td>`).join("")}
                </tr>`
        ).join("");

        const colunasT = colunas.map((col) => `<th>${col}</th>`).join("");
        
        div.innerHTML = `
            <table>
                <thead>
                    <tr>
                        ${colunasT}
                    </tr>
                </thead>
                <tbody>${linhas}</tbody>
            </table>
        `;
    };

    async function carregarPessoas() {
        const quantidade = document.getElementById("quantidade").value;

        try {
            let res = await fetch(`https://fakerapi.it/api/v2/persons?_quantity=${quantidade}`);
            const pessoas = await res.json();
            carregarDiv(pessoas.data, "tabela", propPessoas, colPessoas);
        } catch (err) {
            document.getElementById("tabela").innerHTML = "Erro ao carregar dados.";
        }
    }

    function destacarDados() {
        // Remove destaque anterior
        document.querySelectorAll(".highlight").forEach(cell => {
            cell.classList.remove("highlight");
        });

        const termo = document.getElementById("destaqueFiltro").value.toLowerCase();

        // Se o campo de busca estiver vazio, não faz nada
        if (!termo) return;

        // Percorre todas as células da tabela e aplica o destaque
        const cells = document.querySelectorAll("#tabela td");
        cells.forEach(cell => {
            if (cell.textContent.toLowerCase().includes(termo)) {
                cell.classList.add("highlight");
            }
        });
    }

    function filtrarPorNome() {
        const termo = document.getElementById("nomeFiltro").value.toLowerCase();

        // Pega todas as linhas da tabela
        const rows = document.querySelectorAll("#tabela tbody tr");

        rows.forEach(row => {
            const nome = row.cells[0].textContent.toLowerCase(); // Pega o texto da célula de nome
            if (nome.includes(termo)) {
                row.style.display = ""; // Mostra a linha se o nome coincidir
            } else {
                row.style.display = "none"; // Oculta a linha se o nome não coincidir
            }
        });
    }

    document.getElementById("botaoTabela").addEventListener("click", carregarPessoas);
    document.getElementById("destaqueFiltro").addEventListener("input", destacarDados);
    document.getElementById("nomeFiltro").addEventListener("input", filtrarPorNome);
    // Carrega a tabela automaticamente ao abrir o site
    carregarPessoas();
</script>
</html>
